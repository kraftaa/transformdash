version: '3.8'

services:
  transformdash:
    build: .
    container_name: transformdash
    ports:
      - "8000:8000"
    environment:
      - POSTGRES_HOST=${POSTGRES_HOST:-localhost}
      - POSTGRES_PORT=${POSTGRES_PORT:-5432}
      - POSTGRES_DB=${POSTGRES_DB:-postgres}
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD}
      - MONGO_URI=${MONGO_URI:-mongodb://localhost:27017}
      - MONGO_DB=${MONGO_DB:-testdb}
      - REDIS_HOST=${REDIS_HOST:-localhost}
      - REDIS_PORT=${REDIS_PORT:-6379}
    volumes:
      - ./models:/app/models
      - ./.env:/app/.env
    depends_on:
      - postgres
    restart: unless-stopped
    networks:
      - transformdash-network

  postgres:
    image: postgres:15-alpine
    container_name: transformdash-postgres
    environment:
      - POSTGRES_DB=${POSTGRES_DB:-postgres}
      - POSTGRES_USER=${POSTGRES_USER:-postgres}
      - POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-postgres}
    ports:
      - "5432:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - transformdash-network

  # Optional: Add if you need MongoDB
  # mongodb:
  #   image: mongo:7
  #   container_name: transformdash-mongo
  #   ports:
  #     - "27017:27017"
  #   volumes:
  #     - mongo-data:/data/db
  #   networks:
  #     - transformdash-network

  # Optional: Add if you need Redis
  # redis:
  #   image: redis:7-alpine
  #   container_name: transformdash-redis
  #   ports:
  #     - "6379:6379"
  #   volumes:
  #     - redis-data:/data
  #   networks:
  #     - transformdash-network

volumes:
  postgres-data:
  # mongo-data:
  # redis-data:

networks:
  transformdash-network:
    driver: bridge
